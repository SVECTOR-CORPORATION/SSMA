<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800">
  <!-- Background and Title -->
  <rect width="1200" height="800" fill="#f8f9fa" />
  <text x="600" y="40" font-family="Arial" font-size="24" font-weight="bold" text-anchor="middle" fill="#333">Structured State Matrix Architecture (SSMA)</text>
  <text x="600" y="70" font-family="Arial" font-size="16" text-anchor="middle" fill="#666">A Linear-Complexity, Memory-Efficient Alternative to Transformers</text>
  
  <!-- 1. INPUT AND PREPROCESSING BLOCK -->
  <rect x="50" y="120" width="200" height="120" rx="10" ry="10" fill="#B3E5FC" stroke="#0288D1" stroke-width="2" />
  <text x="150" y="145" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle">Input &amp; Preprocessing</text>
  <rect x="70" y="160" width="160" height="30" rx="5" ry="5" fill="#E1F5FE" stroke="#81D4FA" stroke-width="1" />
  <text x="150" y="180" font-family="Arial" font-size="12" text-anchor="middle">Tokenizer/Preprocessor</text>
  <rect x="70" y="195" width="160" height="30" rx="5" ry="5" fill="#E1F5FE" stroke="#81D4FA" stroke-width="1" />
  <text x="150" y="215" font-family="Arial" font-size="12" text-anchor="middle">Embedding + Positional Encoding</text>
  
  <!-- Data flow arrows -->
  <path d="M 250 180 L 300 180" stroke="#666" stroke-width="2" fill="none" marker-end="url(#arrowhead)" />
  
  <!-- 2. SSMA CORE PROCESSING BLOCK -->
  <!-- Container for the layer stack -->
  <rect x="300" y="100" width="650" height="500" rx="10" ry="10" fill="#ECEFF1" stroke="#607D8B" stroke-width="2" stroke-dasharray="5,5" />
  <text x="625" y="125" font-family="Arial" font-size="18" font-weight="bold" text-anchor="middle">SSMA Core Processing Block (Layer Stack)</text>
  
  <!-- 2.1 Sparse State Transition Module -->
  <rect x="320" y="140" width="280" height="220" rx="10" ry="10" fill="#C8E6C9" stroke="#4CAF50" stroke-width="2" />
  <text x="460" y="165" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle">Sparse State Transition Module</text>
  
  <!-- State Matrix Initialization -->
  <rect x="340" y="175" width="240" height="40" rx="5" ry="5" fill="#E8F5E9" stroke="#A5D6A7" stroke-width="1" />
  <text x="460" y="200" font-family="Arial" font-size="12" text-anchor="middle">State Matrix S ∈ ℝᵈˣᵐ (m≪n)</text>
  
  <!-- Dynamic Update Process -->
  <rect x="340" y="225" width="110" height="40" rx="5" ry="5" fill="#E8F5E9" stroke="#A5D6A7" stroke-width="1" />
  <text x="395" y="245" font-family="Arial" font-size="10" text-anchor="middle">Input Projection</text>
  <text x="395" y="258" font-family="Arial" font-size="10" text-anchor="middle">Wᵢₙ</text>
  
  <rect x="470" y="225" width="110" height="40" rx="5" ry="5" fill="#E8F5E9" stroke="#A5D6A7" stroke-width="1" />
  <text x="525" y="245" font-family="Arial" font-size="10" text-anchor="middle">State Transform</text>
  <text x="525" y="258" font-family="Arial" font-size="10" text-anchor="middle">Wₛₜₐₜₑ</text>
  
  <rect x="340" y="275" width="240" height="35" rx="5" ry="5" fill="#E8F5E9" stroke="#A5D6A7" stroke-width="1" />
  <text x="460" y="297" font-family="Arial" font-size="10" text-anchor="middle">Non-Linear Activation (ReLU)</text>
  
  <rect x="340" y="320" width="240" height="30" rx="5" ry="5" fill="#E8F5E9" stroke="#A5D6A7" stroke-width="1" />
  <text x="460" y="340" font-family="Arial" font-size="10" text-anchor="middle">Top-k Gating</text>
  
  <!-- 2.2 Low-Rank Factorized Interaction Module -->
  <rect x="320" y="370" width="280" height="140" rx="10" ry="10" fill="#FFECB3" stroke="#FFC107" stroke-width="2" />
  <text x="460" y="395" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle">Low-Rank Factorized Interaction</text>
  
  <!-- Low-Rank Projections -->
  <rect x="340" y="410" width="110" height="35" rx="5" ry="5" fill="#FFF8E1" stroke="#FFE082" stroke-width="1" />
  <text x="395" y="430" font-family="Arial" font-size="10" text-anchor="middle">U Projection (d×r)</text>
  
  <rect x="470" y="410" width="110" height="35" rx="5" ry="5" fill="#FFF8E1" stroke="#FFE082" stroke-width="1" />
  <text x="525" y="430" font-family="Arial" font-size="10" text-anchor="middle">V Projection (d×r)</text>
  
  <!-- Interaction Computation -->
  <rect x="340" y="455" width="240" height="35" rx="5" ry="5" fill="#FFF8E1" stroke="#FFE082" stroke-width="1" />
  <text x="460" y="475" font-family="Arial" font-size="10" text-anchor="middle">Low-Rank Interaction (U · V^T)</text>
  
  <!-- Feed-Forward Network -->
  <rect x="650" y="140" width="280" height="120" rx="10" ry="10" fill="#E1BEE7" stroke="#9C27B0" stroke-width="2" />
  <text x="790" y="165" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle">Feed-Forward Network</text>
  
  <rect x="670" y="175" width="240" height="35" rx="5" ry="5" fill="#F3E5F5" stroke="#CE93D8" stroke-width="1" />
  <text x="790" y="195" font-family="Arial" font-size="10" text-anchor="middle">Linear Layer 1</text>
  
  <rect x="670" y="215" width="240" height="35" rx="5" ry="5" fill="#F3E5F5" stroke="#CE93D8" stroke-width="1" />
  <text x="790" y="235" font-family="Arial" font-size="10" text-anchor="middle">Activation (GELU)</text>
  
  <!-- 2.3 Hierarchical Memory Module -->
  <rect x="650" y="270" width="280" height="140" rx="10" ry="10" fill="#BBDEFB" stroke="#2196F3" stroke-width="2" />
  <text x="790" y="295" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle">Hierarchical Memory Module (LRU)</text>
  
  <!-- Memory Bank -->
  <rect x="670" y="310" width="240" height="35" rx="5" ry="5" fill="#E3F2FD" stroke="#90CAF9" stroke-width="1" />
  <text x="790" y="330" font-family="Arial" font-size="10" text-anchor="middle">Memory Bank M ∈ ℝᵐˣᵈ</text>
  
  <!-- Memory Update Mechanism -->
  <rect x="670" y="355" width="240" height="35" rx="5" ry="5" fill="#E3F2FD" stroke="#90CAF9" stroke-width="1" />
  <text x="790" y="375" font-family="Arial" font-size="10" text-anchor="middle">M^(t) = γM^(t-1) + (1-γ)S^(t)</text>
  
  <!-- 2.4 Quantization Module -->
  <rect x="650" y="420" width="280" height="100" rx="10" ry="10" fill="#FFCDD2" stroke="#F44336" stroke-width="2" />
  <text x="790" y="445" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle">Quantization Module</text>
  
  <!-- Ternary Quantization -->
  <rect x="670" y="460" width="240" height="45" rx="5" ry="5" fill="#FFEBEE" stroke="#EF9A9A" stroke-width="1" />
  <text x="790" y="480" font-family="Arial" font-size="10" text-anchor="middle">Ternary Weight Quantization</text>
  <text x="790" y="495" font-family="Arial" font-size="10" text-anchor="middle">Values: {-1, 0, +1}</text>
  
  <!-- 2.5 Hybrid Layer (Optional) -->
  <rect x="650" y="530" width="280" height="60" rx="10" ry="10" fill="#D1C4E9" stroke="#673AB7" stroke-width="2" />
  <text x="790" y="555" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle">Hybrid Layer (Optional)</text>
  <text x="790" y="575" font-family="Arial" font-size="10" text-anchor="middle">Toggle between Self-Attention/SSMA</text>
  
  <!-- 3. OUTPUT PROCESSING BLOCK -->
  <rect x="1000" y="300" width="150" height="120" rx="10" ry="10" fill="#FFCCBC" stroke="#FF5722" stroke-width="2" />
  <text x="1075" y="325" font-family="Arial" font-size="16" font-weight="bold" text-anchor="middle">Output Processing</text>
  
  <rect x="1020" y="340" width="110" height="30" rx="5" ry="5" fill="#FBE9E7" stroke="#FFAB91" stroke-width="1" />
  <text x="1075" y="360" font-family="Arial" font-size="10" text-anchor="middle">Layer Normalization</text>
  
  <rect x="1020" y="380" width="110" height="30" rx="5" ry="5" fill="#FBE9E7" stroke="#FFAB91" stroke-width="1" />
  <text x="1075" y="400" font-family="Arial" font-size="10" text-anchor="middle">Output Projection</text>
  
  <!-- Connection arrows between modules -->
  <!-- From Input to State Transition -->
  <path d="M 460 140 L 460 120 L 250 120 L 250 180 L 300 180" stroke="#666" stroke-width="1.5" fill="none" marker-end="url(#arrowhead)" stroke-dasharray="5,3" />
  
  <!-- From State Transition to Low-Rank -->
  <path d="M 460 360 L 460 370" stroke="#666" stroke-width="1.5" fill="none" marker-end="url(#arrowhead)" />
  
  <!-- From Low-Rank to FFN -->
  <path d="M 600 430 L 625 430 L 625 220 L 650 220" stroke="#666" stroke-width="1.5" fill="none" marker-end="url(#arrowhead)" />
  
  <!-- From FFN to Memory -->
  <path d="M 790 240 L 790 270" stroke="#666" stroke-width="1.5" fill="none" marker-end="url(#arrowhead)" />
  
  <!-- From Memory to Quantization -->
  <path d="M 790 410 L 790 420" stroke="#666" stroke-width="1.5" fill="none" marker-end="url(#arrowhead)" />
  
  <!-- From Quantization to Hybrid Layer -->
  <path d="M 790 520 L 790 530" stroke="#666" stroke-width="1.5" fill="none" marker-end="url(#arrowhead)" />
  
  <!-- From SSMA Core to Output -->
  <path d="M 950 360 L 1000 360" stroke="#666" stroke-width="1.5" fill="none" marker-end="url(#arrowhead)" />
  
  <!-- Memory feedback loop -->
  <path d="M 920 355 C 940 355, 950 325, 950 305 C 950 285, 940 255, 920 255 L 900 255" stroke="#2196F3" stroke-width="2" fill="none" marker-end="url(#arrowhead-blue)" stroke-dasharray="3,2" />
  <text x="950" y="315" font-family="Arial" font-size="10" fill="#2196F3" transform="rotate(90, 950, 315)">Memory Feedback</text>
  
  <!-- State update loop -->
  <path d="M 320 250 C 300 250, 290 220, 290 200 C 290 180, 300 150, 320 150" stroke="#4CAF50" stroke-width="2" fill="none" marker-end="url(#arrowhead-green)" stroke-dasharray="3,2" />
  <text x="270" y="200" font-family="Arial" font-size="10" fill="#4CAF50" transform="rotate(-90, 270, 200)">State Update</text>
  
  <!-- Explanatory callouts -->
  <!-- Linear Complexity Callout -->
  <rect x="50" y="600" width="200" height="80" rx="10" ry="10" fill="white" stroke="#333" stroke-width="1" />
  <text x="150" y="625" font-family